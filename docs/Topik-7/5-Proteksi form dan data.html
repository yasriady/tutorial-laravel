<!DOCTYPE html>
<html>
<head>
<title>5-Proteksi form dan data.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="tutorial-proteksi-form-dan-data-di-laravel">Tutorial Proteksi Form dan Data di Laravel</h1>
<p>Keamanan data adalah komponen kritis dalam pengembangan aplikasi web. Pada tutorial ini, kita akan mempelajari cara melindungi form dan data dalam aplikasi Laravel untuk manajemen data mahasiswa. Proteksi ini penting untuk mencegah akses tidak sah, serangan CSRF, dan manipulasi data yang tidak diinginkan.</p>
<h2 id="1-proteksi-csrf-cross-site-request-forgery">1. Proteksi CSRF (Cross-Site Request Forgery)</h2>
<p>CSRF adalah serangan yang memaksa pengguna untuk menjalankan tindakan yang tidak diinginkan pada aplikasi web. Laravel menyediakan perlindungan bawaan terhadap CSRF.</p>
<h3 id="implementasi-token-csrf">Implementasi Token CSRF:</h3>
<pre class="hljs"><code><div>&lt;form method=<span class="hljs-string">"POST"</span> action=<span class="hljs-string">"/mahasiswa"</span>&gt;
    @csrf
    &lt;!-- Form fields --&gt;
    &lt;input type=<span class="hljs-string">"text"</span> name=<span class="hljs-string">"nama"</span> value=<span class="hljs-string">"{{ old('nama') }}"</span>&gt;
    &lt;button type=<span class="hljs-string">"submit"</span>&gt;Simpan&lt;/button&gt;
&lt;/form&gt;
</div></code></pre>
<p>Laravel akan secara otomatis menolak permintaan POST tanpa token CSRF yang valid. Middleware <code>VerifyCsrfToken</code> sudah diaktifkan secara default di Laravel.</p>
<h2 id="2-validasi-form-input">2. Validasi Form Input</h2>
<p>Validasi input sangat penting untuk mencegah data yang tidak valid atau berbahaya.</p>
<h3 id="implementasi-validasi">Implementasi Validasi:</h3>
<pre class="hljs"><code><div><span class="hljs-comment">// MahasiswaController.php</span>
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">store</span><span class="hljs-params">(Request $request)</span>
</span>{
    $validated = $request-&gt;validate([
        <span class="hljs-string">'nim'</span> =&gt; <span class="hljs-string">'required|string|max:20|unique:mahasiswas'</span>,
        <span class="hljs-string">'nama'</span> =&gt; <span class="hljs-string">'required|string|max:255'</span>,
        <span class="hljs-string">'email'</span> =&gt; <span class="hljs-string">'required|email|unique:mahasiswas'</span>,
        <span class="hljs-string">'jurusan_id'</span> =&gt; <span class="hljs-string">'required|exists:jurusans,id'</span>,
        <span class="hljs-string">'tanggal_lahir'</span> =&gt; <span class="hljs-string">'required|date|before:today'</span>,
    ]);
    
    Mahasiswa::create($validated);
    
    <span class="hljs-keyword">return</span> redirect()-&gt;route(<span class="hljs-string">'mahasiswa.index'</span>)
        -&gt;with(<span class="hljs-string">'success'</span>, <span class="hljs-string">'Data mahasiswa berhasil disimpan.'</span>);
}
</div></code></pre>
<h3 id="menampilkan-pesan-error">Menampilkan Pesan Error:</h3>
<pre class="hljs"><code><div>&lt;div <span class="hljs-class"><span class="hljs-keyword">class</span>="<span class="hljs-title">form</span>-<span class="hljs-title">group</span>"&gt;
    &lt;<span class="hljs-title">label</span> <span class="hljs-title">for</span>="<span class="hljs-title">nim</span>"&gt;<span class="hljs-title">NIM</span>&lt;/<span class="hljs-title">label</span>&gt;
    &lt;<span class="hljs-title">input</span> <span class="hljs-title">type</span>="<span class="hljs-title">text</span>" <span class="hljs-title">name</span>="<span class="hljs-title">nim</span>" <span class="hljs-title">value</span>="</span>{{ old(<span class="hljs-string">'nim'</span>) }}<span class="hljs-string">" class="</span>form-control @error(<span class="hljs-string">'nim'</span>) is-invalid @enderror<span class="hljs-string">"&gt;
    @error('nim')
        &lt;div class="</span>invalid-feedback<span class="hljs-string">"&gt;{{ $message }}&lt;/div&gt;
    @enderror
&lt;/div&gt;
</span></div></code></pre>
<h2 id="3-mass-assignment-protection">3. Mass Assignment Protection</h2>
<p>Proteksi mass assignment mencegah pengguna memodifikasi kolom yang tidak seharusnya bisa diubah.</p>
<h3 id="mengamankan-model">Mengamankan Model:</h3>
<pre class="hljs"><code><div><span class="hljs-comment">// app/Models/Mahasiswa.php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Mahasiswa</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Model</span>
</span>{
    <span class="hljs-comment">// Hanya kolom-kolom ini yang bisa diisi massal</span>
    <span class="hljs-keyword">protected</span> $fillable = [
        <span class="hljs-string">'nim'</span>, <span class="hljs-string">'nama'</span>, <span class="hljs-string">'email'</span>, <span class="hljs-string">'jurusan_id'</span>, <span class="hljs-string">'tanggal_lahir'</span>, <span class="hljs-string">'alamat'</span>
    ];
    
    <span class="hljs-comment">// Kolom-kolom ini tidak boleh diisi dengan mass assignment</span>
    <span class="hljs-keyword">protected</span> $guarded = [
        <span class="hljs-string">'id'</span>, <span class="hljs-string">'created_at'</span>, <span class="hljs-string">'updated_at'</span>, <span class="hljs-string">'status_verifikasi'</span>
    ];
}
</div></code></pre>
<h2 id="4-form-request-validation">4. Form Request Validation</h2>
<p>Untuk validasi yang lebih kompleks, gunakan Form Request:</p>
<pre class="hljs"><code><div>php artisan make:request StoreMahasiswaRequest
</div></code></pre>
<pre class="hljs"><code><div><span class="hljs-comment">// app/Http/Requests/StoreMahasiswaRequest.php</span>
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">authorize</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// Cek apakah user boleh melakukan aksi ini</span>
    <span class="hljs-keyword">return</span> auth()-&gt;user()-&gt;hasPermission(<span class="hljs-string">'create-mahasiswa'</span>);
}

<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rules</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">return</span> [
        <span class="hljs-string">'nim'</span> =&gt; <span class="hljs-string">'required|string|max:20|unique:mahasiswas'</span>,
        <span class="hljs-string">'nama'</span> =&gt; <span class="hljs-string">'required|string|max:255'</span>,
        <span class="hljs-string">'email'</span> =&gt; <span class="hljs-string">'required|email|unique:mahasiswas'</span>,
        <span class="hljs-string">'jurusan_id'</span> =&gt; <span class="hljs-string">'required|exists:jurusans,id'</span>,
        <span class="hljs-string">'tanggal_lahir'</span> =&gt; <span class="hljs-string">'required|date|before:today'</span>,
        <span class="hljs-string">'alamat'</span> =&gt; <span class="hljs-string">'nullable|string|max:500'</span>,
    ];
}
</div></code></pre>
<p>Penggunaan di Controller:</p>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">store</span><span class="hljs-params">(StoreMahasiswaRequest $request)</span>
</span>{
    <span class="hljs-comment">// Data sudah tervalidasi dan user sudah diauthorisasi</span>
    $validated = $request-&gt;validated();
    
    Mahasiswa::create($validated);
    
    <span class="hljs-keyword">return</span> redirect()-&gt;route(<span class="hljs-string">'mahasiswa.index'</span>)
        -&gt;with(<span class="hljs-string">'success'</span>, <span class="hljs-string">'Data mahasiswa berhasil disimpan.'</span>);
}
</div></code></pre>
<h2 id="5-sanitasi-input">5. Sanitasi Input</h2>
<p>Bersihkan input pengguna untuk mencegah XSS:</p>
<pre class="hljs"><code><div><span class="hljs-comment">// Di dalam Controller atau Form Request</span>
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">store</span><span class="hljs-params">(Request $request)</span>
</span>{
    $validated = $request-&gt;validate([
        <span class="hljs-string">'nama'</span> =&gt; <span class="hljs-string">'required|string|max:255'</span>,
        <span class="hljs-string">'bio'</span> =&gt; <span class="hljs-string">'nullable|string|max:1000'</span>,
    ]);
    
    <span class="hljs-comment">// Sanitasi html</span>
    $validated[<span class="hljs-string">'bio'</span>] = strip_tags($validated[<span class="hljs-string">'bio'</span>]);
    
    <span class="hljs-comment">// Atau gunakan HTML Purifier untuk sanitasi yang lebih aman</span>
    <span class="hljs-comment">// $validated['bio'] = clean($validated['bio']);</span>
    
    Mahasiswa::create($validated);
    
    <span class="hljs-keyword">return</span> redirect()-&gt;route(<span class="hljs-string">'mahasiswa.index'</span>)
        -&gt;with(<span class="hljs-string">'success'</span>, <span class="hljs-string">'Data mahasiswa berhasil disimpan.'</span>);
}
</div></code></pre>
<p>Menggunakan HTML Purifier (memerlukan instalasi paket):</p>
<pre class="hljs"><code><div>composer require mews/purifier
</div></code></pre>
<pre class="hljs"><code><div>$validated[<span class="hljs-string">'bio'</span>] = clean($validated[<span class="hljs-string">'bio'</span>]);
</div></code></pre>
<h2 id="6-policy-untuk-otorisasi">6. Policy untuk Otorisasi</h2>
<p>Buat policy untuk mengatur siapa yang bisa mengakses atau memodifikasi data:</p>
<pre class="hljs"><code><div>php artisan make:policy MahasiswaPolicy --model=Mahasiswa
</div></code></pre>
<pre class="hljs"><code><div><span class="hljs-comment">// app/Policies/MahasiswaPolicy.php</span>
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">view</span><span class="hljs-params">(User $user, Mahasiswa $mahasiswa)</span>
</span>{
    <span class="hljs-comment">// Admin dan dosen bisa melihat semua data</span>
    <span class="hljs-keyword">if</span> ($user-&gt;hasRole(<span class="hljs-string">'admin'</span>) || $user-&gt;hasRole(<span class="hljs-string">'dosen'</span>)) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    }
    
    <span class="hljs-comment">// Mahasiswa hanya bisa melihat data mereka sendiri</span>
    <span class="hljs-keyword">return</span> $user-&gt;hasRole(<span class="hljs-string">'mahasiswa'</span>) &amp;&amp; $user-&gt;id === $mahasiswa-&gt;user_id;
}

<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update</span><span class="hljs-params">(User $user, Mahasiswa $mahasiswa)</span>
</span>{
    <span class="hljs-comment">// Admin bisa mengubah semua data</span>
    <span class="hljs-keyword">if</span> ($user-&gt;hasRole(<span class="hljs-string">'admin'</span>)) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    }
    
    <span class="hljs-comment">// Dosen bisa mengubah data mahasiswa dalam kelasnya</span>
    <span class="hljs-keyword">if</span> ($user-&gt;hasRole(<span class="hljs-string">'dosen'</span>)) {
        <span class="hljs-keyword">return</span> $user-&gt;kelas-&gt;contains($mahasiswa-&gt;kelas_id);
    }
    
    <span class="hljs-comment">// Mahasiswa hanya bisa mengubah data mereka sendiri</span>
    <span class="hljs-keyword">return</span> $user-&gt;hasRole(<span class="hljs-string">'mahasiswa'</span>) &amp;&amp; $user-&gt;id === $mahasiswa-&gt;user_id;
}
</div></code></pre>
<p>Penggunaan di Controller:</p>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">edit</span><span class="hljs-params">(Mahasiswa $mahasiswa)</span>
</span>{
    <span class="hljs-keyword">$this</span>-&gt;authorize(<span class="hljs-string">'update'</span>, $mahasiswa);
    
    <span class="hljs-keyword">return</span> view(<span class="hljs-string">'mahasiswa.edit'</span>, compact(<span class="hljs-string">'mahasiswa'</span>));
}

<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update</span><span class="hljs-params">(Request $request, Mahasiswa $mahasiswa)</span>
</span>{
    <span class="hljs-keyword">$this</span>-&gt;authorize(<span class="hljs-string">'update'</span>, $mahasiswa);
    
    <span class="hljs-comment">// Proses update...</span>
}
</div></code></pre>
<h2 id="7-response-filtering">7. Response Filtering</h2>
<p>Filter data yang dikembalikan ke pengguna:</p>
<pre class="hljs"><code><div><span class="hljs-comment">// Menggunakan Resource untuk memfilter kolom yang ditampilkan</span>
php artisan make:resource MahasiswaResource
</div></code></pre>
<pre class="hljs"><code><div><span class="hljs-comment">// app/Http/Resources/MahasiswaResource.php</span>
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toArray</span><span class="hljs-params">($request)</span>
</span>{
    <span class="hljs-comment">// Admin dan dosen bisa melihat semua data</span>
    <span class="hljs-keyword">if</span> (auth()-&gt;user()-&gt;hasRole([<span class="hljs-string">'admin'</span>, <span class="hljs-string">'dosen'</span>])) {
        <span class="hljs-keyword">return</span> [
            <span class="hljs-string">'id'</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;id,
            <span class="hljs-string">'nim'</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;nim,
            <span class="hljs-string">'nama'</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;nama,
            <span class="hljs-string">'email'</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;email,
            <span class="hljs-string">'jurusan'</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;jurusan-&gt;nama,
            <span class="hljs-string">'tanggal_lahir'</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;tanggal_lahir,
            <span class="hljs-string">'alamat'</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;alamat,
            <span class="hljs-string">'nilai'</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;nilai,
        ];
    }
    
    <span class="hljs-comment">// Mahasiswa hanya melihat data terbatas</span>
    <span class="hljs-keyword">return</span> [
        <span class="hljs-string">'id'</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;id,
        <span class="hljs-string">'nim'</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;nim,
        <span class="hljs-string">'nama'</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;nama,
        <span class="hljs-string">'email'</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;email,
        <span class="hljs-string">'jurusan'</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;jurusan-&gt;nama,
    ];
}
</div></code></pre>
<p>Penggunaan di Controller:</p>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">show</span><span class="hljs-params">(Mahasiswa $mahasiswa)</span>
</span>{
    <span class="hljs-keyword">$this</span>-&gt;authorize(<span class="hljs-string">'view'</span>, $mahasiswa);
    
    <span class="hljs-keyword">return</span> view(<span class="hljs-string">'mahasiswa.show'</span>, [
        <span class="hljs-string">'mahasiswa'</span> =&gt; <span class="hljs-keyword">new</span> MahasiswaResource($mahasiswa)
    ]);
}
</div></code></pre>
<h2 id="8-pencegahan-sql-injection">8. Pencegahan SQL Injection</h2>
<p>Laravel's Query Builder dan Eloquent ORM sudah aman dari SQL Injection, namun perlu berhati-hati dengan query manual:</p>
<pre class="hljs"><code><div><span class="hljs-comment">// TIDAK AMAN:</span>
$results = DB::select(<span class="hljs-string">"SELECT * FROM mahasiswas WHERE nama LIKE '%$searchTerm%'"</span>);

<span class="hljs-comment">// AMAN - menggunakan parameter binding:</span>
$results = DB::select(<span class="hljs-string">"SELECT * FROM mahasiswas WHERE nama LIKE ?"</span>, [<span class="hljs-string">"%$searchTerm%"</span>]);

<span class="hljs-comment">// LEBIH AMAN - menggunakan Query Builder:</span>
$results = DB::table(<span class="hljs-string">'mahasiswas'</span>)-&gt;where(<span class="hljs-string">'nama'</span>, <span class="hljs-string">'like'</span>, <span class="hljs-string">"%$searchTerm%"</span>)-&gt;get();

<span class="hljs-comment">// PALING DISARANKAN - menggunakan Eloquent:</span>
$results = Mahasiswa::where(<span class="hljs-string">'nama'</span>, <span class="hljs-string">'like'</span>, <span class="hljs-string">"%$searchTerm%"</span>)-&gt;get();
</div></code></pre>
<h2 id="9-proteksi-dari-method-spoofing">9. Proteksi dari Method Spoofing</h2>
<p>Terapkan proteksi untuk route-route tertentu:</p>
<pre class="hljs"><code><div><span class="hljs-comment">// routes/web.php</span>
Route::match([<span class="hljs-string">'get'</span>, <span class="hljs-string">'head'</span>], <span class="hljs-string">'mahasiswa'</span>, [MahasiswaController::class, <span class="hljs-string">'index'</span>]);
Route::post(<span class="hljs-string">'mahasiswa'</span>, [MahasiswaController::class, <span class="hljs-string">'store'</span>]);
</div></code></pre>
<p>Laravel sudah menerapkan proteksi method spoofing, tapi kita bisa menambahkan middleware tambahan jika diperlukan.</p>
<h2 id="10-enkripsi-data-sensitif">10. Enkripsi Data Sensitif</h2>
<p>Enkripsi data sensitif sebelum disimpan:</p>
<pre class="hljs"><code><div><span class="hljs-comment">// app/Models/Mahasiswa.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Database</span>\<span class="hljs-title">Eloquent</span>\<span class="hljs-title">Casts</span>\<span class="hljs-title">Attribute</span>;

<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">noKtp</span><span class="hljs-params">()</span>: <span class="hljs-title">Attribute</span>
</span>{
    <span class="hljs-keyword">return</span> Attribute::make(
        get: fn ($value) =&gt; decrypt($value),
        set: fn ($value) =&gt; encrypt($value),
    );
}
</div></code></pre>
<pre><code class="language-mermaid"><div class="mermaid">flowchart TD
    A[User mengirim form data] --> B{CSRF Token valid?}
    B -->|Tidak| C[403 Forbidden Response]
    B -->|Ya| D{Pengguna Terautentikasi?}
    D -->|Tidak| E[Redirect ke login]
    D -->|Ya| F{Pengguna Terotorisasi?}
    F -->|Tidak| G[403 Forbidden Response]
    F -->|Ya| H[Validasi Input]
    H -->|Invalid| I[Redirect dengan error]
    H -->|Valid| J[Sanitasi Input]
    J --> K[Proses Data]
    K --> L[Filter Response]
    L --> M[Return Response]

</div></code></pre>
<h2 id="diagram-proses-untuk-proteksi-form-dan-data">Diagram Proses untuk Proteksi Form dan Data</h2>
<pre><code class="language-mermaid"><div class="mermaid">sequenceDiagram
    participant User
    participant Form
    participant Controller
    participant Middleware
    participant Validator
    participant Policy
    participant Model
    
    User->>Form: Submit Data
    Form->>Controller: HTTP POST/PUT Request + CSRF Token
    Controller->>Middleware: Process Request
    
    Note over Middleware: CSRF Verification
    Middleware->>Middleware: Verify CSRF Token
    
    alt CSRF Invalid
        Middleware-->>User: 419 Token Mismatch Exception
    else CSRF Valid
        Middleware->>Controller: Continue
        
        Note over Controller: Authentication Check
        Controller->>Policy: Authorize Action
        
        alt Not Authorized
            Policy-->>User: 403 Forbidden
        else Authorized
            Policy->>Controller: Authorized
            Controller->>Validator: Validate Input
            
            alt Validation Failed
                Validator-->>User: Redirect with Errors
            else Validation Passed
                Validator->>Controller: Validated Data
                Controller->>Controller: Sanitize Data
                Controller->>Model: Save Data
                Model-->>Controller: Save Success
                Controller-->>User: Success Response
            end
        end
    end

</div></code></pre>
<h2 id="tips-tambahan-untuk-proteksi-form-dan-data">Tips Tambahan untuk Proteksi Form dan Data</h2>
<ol>
<li><strong>Gunakan rate limiting</strong> untuk mencegah brute force dan DoS:</li>
</ol>
<pre class="hljs"><code><div><span class="hljs-comment">// routes/web.php</span>
Route::middleware([<span class="hljs-string">'throttle:5,1'</span>])-&gt;group(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
    Route::post(<span class="hljs-string">'/login'</span>, [AuthController::class, <span class="hljs-string">'login'</span>]);
});
</div></code></pre>
<ol start="2">
<li><strong>Implementasi honeypot field</strong> untuk menangkap bot:</li>
</ol>
<pre class="hljs"><code><div>&lt;input type=<span class="hljs-string">"text"</span> name=<span class="hljs-string">"website"</span> style=<span class="hljs-string">"display:none"</span>&gt;
</div></code></pre>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rules</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">return</span> [
        <span class="hljs-string">'website'</span> =&gt; <span class="hljs-string">'honeypot'</span>,
        <span class="hljs-comment">// field lain...</span>
    ];
}
</div></code></pre>
<ol start="3">
<li><strong>Gunakan middleware terpisah untuk proses sensitif</strong>:</li>
</ol>
<pre class="hljs"><code><div><span class="hljs-comment">// app/Http/Middleware/VerifyAdmin.php</span>
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handle</span><span class="hljs-params">($request, Closure $next)</span>
</span>{
    <span class="hljs-keyword">if</span> (!auth()-&gt;check() || !auth()-&gt;user()-&gt;isAdmin()) {
        Log::warning(<span class="hljs-string">'Unauthorized admin access attempt by: '</span> . 
            (auth()-&gt;check() ? auth()-&gt;user()-&gt;email : <span class="hljs-string">'guest'</span>));
        abort(<span class="hljs-number">403</span>);
    }
    
    <span class="hljs-keyword">return</span> $next($request);
}
</div></code></pre>
<ol start="4">
<li><strong>Implementasi autentikasi dua faktor</strong>:</li>
</ol>
<pre class="hljs"><code><div><span class="hljs-comment">// Contoh alur 2FA sederhana</span>
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span><span class="hljs-params">(Request $request)</span>
</span>{
    <span class="hljs-keyword">if</span> (Auth::attempt($request-&gt;only(<span class="hljs-string">'email'</span>, <span class="hljs-string">'password'</span>))) {
        $user = Auth::user();
        <span class="hljs-keyword">if</span> ($user-&gt;using_2fa) {
            <span class="hljs-comment">// Kirim kode OTP</span>
            $code = random_int(<span class="hljs-number">100000</span>, <span class="hljs-number">999999</span>);
            $user-&gt;update([<span class="hljs-string">'otp_code'</span> =&gt; Hash::make($code)]);
            <span class="hljs-comment">// Kirim email/SMS dengan kode</span>
            
            <span class="hljs-keyword">return</span> redirect()-&gt;route(<span class="hljs-string">'2fa.verify'</span>);
        }
        
        <span class="hljs-keyword">return</span> redirect()-&gt;intended(<span class="hljs-string">'dashboard'</span>);
    }
    
    <span class="hljs-keyword">return</span> back()-&gt;withErrors([
        <span class="hljs-string">'email'</span> =&gt; <span class="hljs-string">'Kredensial tidak valid.'</span>,
    ]);
}
</div></code></pre>
<ol start="5">
<li><strong>Batasi akses API dengan token</strong>:</li>
</ol>
<pre class="hljs"><code><div><span class="hljs-comment">// routes/api.php</span>
Route::middleware(<span class="hljs-string">'auth:sanctum'</span>)-&gt;get(<span class="hljs-string">'/mahasiswa'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(Request $request)</span> </span>{
    <span class="hljs-keyword">return</span> $request-&gt;user()-&gt;mahasiswa;
});
</div></code></pre>
<p>Dengan mengikuti panduan ini, Anda dapat meningkatkan keamanan aplikasi Laravel Anda secara signifikan. Ingat bahwa keamanan adalah proses berkelanjutan, jadi selalu pantau dan perbarui praktik keamanan Anda seiring perkembangan aplikasi.</p>

</body>
</html>
