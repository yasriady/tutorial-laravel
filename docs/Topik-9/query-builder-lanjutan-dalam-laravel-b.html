<!DOCTYPE html>
<html>
<head>
<title>query-builder-lanjutan-dalam-laravel-b.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="query-builder-lanjutan-dalam-laravel">Query Builder Lanjutan dalam Laravel</h1>
<p>Query Builder Laravel menyediakan antarmuka yang intuitif untuk membuat dan menjalankan query database. Setelah mempelajari dasar-dasar Query Builder, kita akan memperluas pengetahuan dengan teknik-teknik yang lebih canggih untuk memaksimalkan kemampuan Query Builder dalam menangani kasus yang lebih kompleks.</p>
<h2 id="1-query-join-lanjutan">1. Query Join Lanjutan</h2>
<h3 id="join-multiple-tables">Join Multiple Tables</h3>
<pre class="hljs"><code><div>DB::table(<span class="hljs-string">'mahasiswa'</span>)
    -&gt;join(<span class="hljs-string">'jurusan'</span>, <span class="hljs-string">'mahasiswa.jurusan_id'</span>, <span class="hljs-string">'='</span>, <span class="hljs-string">'jurusan.id'</span>)
    -&gt;join(<span class="hljs-string">'fakultas'</span>, <span class="hljs-string">'jurusan.fakultas_id'</span>, <span class="hljs-string">'='</span>, <span class="hljs-string">'fakultas.id'</span>)
    -&gt;select(<span class="hljs-string">'mahasiswa.*'</span>, <span class="hljs-string">'jurusan.nama as jurusan'</span>, <span class="hljs-string">'fakultas.nama as fakultas'</span>)
    -&gt;get();
</div></code></pre>
<h3 id="left-join-dan-right-join">Left Join dan Right Join</h3>
<pre class="hljs"><code><div><span class="hljs-comment">// Left Join - menampilkan semua mahasiswa meskipun tidak memiliki jurusan</span>
DB::table(<span class="hljs-string">'mahasiswa'</span>)
    -&gt;leftJoin(<span class="hljs-string">'jurusan'</span>, <span class="hljs-string">'mahasiswa.jurusan_id'</span>, <span class="hljs-string">'='</span>, <span class="hljs-string">'jurusan.id'</span>)
    -&gt;select(<span class="hljs-string">'mahasiswa.*'</span>, <span class="hljs-string">'jurusan.nama as jurusan'</span>)
    -&gt;get();

<span class="hljs-comment">// Right Join - menampilkan semua jurusan meskipun tidak memiliki mahasiswa</span>
DB::table(<span class="hljs-string">'mahasiswa'</span>)
    -&gt;rightJoin(<span class="hljs-string">'jurusan'</span>, <span class="hljs-string">'mahasiswa.jurusan_id'</span>, <span class="hljs-string">'='</span>, <span class="hljs-string">'jurusan.id'</span>)
    -&gt;select(<span class="hljs-string">'mahasiswa.*'</span>, <span class="hljs-string">'jurusan.nama as jurusan'</span>)
    -&gt;get();
</div></code></pre>
<h3 id="cross-join">Cross Join</h3>
<pre class="hljs"><code><div><span class="hljs-comment">// Menghasilkan cartesian product dari kedua tabel</span>
DB::table(<span class="hljs-string">'mahasiswa'</span>)
    -&gt;crossJoin(<span class="hljs-string">'jurusan'</span>)
    -&gt;select(<span class="hljs-string">'mahasiswa.nama'</span>, <span class="hljs-string">'jurusan.nama as jurusan'</span>)
    -&gt;get();
</div></code></pre>
<h2 id="2-subquery-dan-derived-tables">2. Subquery dan Derived Tables</h2>
<h3 id="subquery-dalam-select">Subquery dalam Select</h3>
<pre class="hljs"><code><div>DB::table(<span class="hljs-string">'mahasiswa'</span>)
    -&gt;select(<span class="hljs-string">'nama'</span>, <span class="hljs-string">'nim'</span>, DB::raw(<span class="hljs-string">'(SELECT AVG(nilai) FROM nilai WHERE nilai.mahasiswa_id = mahasiswa.id) as rata_nilai'</span>))
    -&gt;get();
</div></code></pre>
<h3 id="subquery-dalam-where">Subquery dalam Where</h3>
<pre class="hljs"><code><div>DB::table(<span class="hljs-string">'mahasiswa'</span>)
    -&gt;whereIn(<span class="hljs-string">'jurusan_id'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($query)</span> </span>{
        $query-&gt;select(<span class="hljs-string">'id'</span>)
              -&gt;from(<span class="hljs-string">'jurusan'</span>)
              -&gt;where(<span class="hljs-string">'fakultas_id'</span>, <span class="hljs-number">1</span>);
    })
    -&gt;get();
</div></code></pre>
<h3 id="subquery-sebagai-derived-table">Subquery sebagai Derived Table</h3>
<pre class="hljs"><code><div>DB::table(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($query)</span> </span>{
    $query-&gt;select(<span class="hljs-string">'mahasiswa_id'</span>, DB::raw(<span class="hljs-string">'AVG(nilai) as nilai_rata'</span>))
          -&gt;from(<span class="hljs-string">'nilai'</span>)
          -&gt;groupBy(<span class="hljs-string">'mahasiswa_id'</span>)
          -&gt;havingRaw(<span class="hljs-string">'AVG(nilai) &gt; 80'</span>);
}, <span class="hljs-string">'nilai_tinggi'</span>)
    -&gt;join(<span class="hljs-string">'mahasiswa'</span>, <span class="hljs-string">'nilai_tinggi.mahasiswa_id'</span>, <span class="hljs-string">'='</span>, <span class="hljs-string">'mahasiswa.id'</span>)
    -&gt;select(<span class="hljs-string">'mahasiswa.*'</span>, <span class="hljs-string">'nilai_tinggi.nilai_rata'</span>)
    -&gt;get();
</div></code></pre>
<h2 id="3-advanced-where-clauses">3. Advanced Where Clauses</h2>
<h3 id="whereexists-dan-wherenotexists">WhereExists dan WhereNotExists</h3>
<pre class="hljs"><code><div>DB::table(<span class="hljs-string">'mahasiswa'</span>)
    -&gt;whereExists(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($query)</span> </span>{
        $query-&gt;select(DB::raw(<span class="hljs-number">1</span>))
              -&gt;from(<span class="hljs-string">'kehadiran'</span>)
              -&gt;whereColumn(<span class="hljs-string">'kehadiran.mahasiswa_id'</span>, <span class="hljs-string">'mahasiswa.id'</span>)
              -&gt;where(<span class="hljs-string">'tanggal'</span>, today())
              -&gt;limit(<span class="hljs-number">1</span>);
    })
    -&gt;get(); <span class="hljs-comment">// Mahasiswa yang hadir hari ini</span>
</div></code></pre>
<h3 id="where-dengan-json-column-laravel-56">Where dengan JSON Column (Laravel 5.6+)</h3>
<pre class="hljs"><code><div><span class="hljs-comment">// Asumsikan ada kolom 'metadata' bertipe JSON</span>
DB::table(<span class="hljs-string">'mahasiswa'</span>)
    -&gt;where(<span class="hljs-string">'metadata-&gt;alamat-&gt;kota'</span>, <span class="hljs-string">'Jakarta'</span>)
    -&gt;get();
</div></code></pre>
<h3 id="where-between-date-range">Where Between Date Range</h3>
<pre class="hljs"><code><div>DB::table(<span class="hljs-string">'mahasiswa'</span>)
    -&gt;whereBetween(<span class="hljs-string">'tanggal_lahir'</span>, [
        now()-&gt;subYears(<span class="hljs-number">20</span>),
        now()-&gt;subYears(<span class="hljs-number">18</span>)
    ])
    -&gt;get(); <span class="hljs-comment">// Mahasiswa berusia 18-20 tahun</span>
</div></code></pre>
<h2 id="4-advanced-group-by-dan-having">4. Advanced Group By dan Having</h2>
<h3 id="group-by-multiple-columns">Group By Multiple Columns</h3>
<pre class="hljs"><code><div>DB::table(<span class="hljs-string">'nilai'</span>)
    -&gt;select(<span class="hljs-string">'mahasiswa_id'</span>, <span class="hljs-string">'mata_kuliah_id'</span>, DB::raw(<span class="hljs-string">'AVG(nilai) as rata_nilai'</span>))
    -&gt;groupBy(<span class="hljs-string">'mahasiswa_id'</span>, <span class="hljs-string">'mata_kuliah_id'</span>)
    -&gt;get();
</div></code></pre>
<h3 id="having-dengan-raw-sql">Having dengan Raw SQL</h3>
<pre class="hljs"><code><div>DB::table(<span class="hljs-string">'nilai'</span>)
    -&gt;select(<span class="hljs-string">'mahasiswa_id'</span>, DB::raw(<span class="hljs-string">'COUNT(*) as jumlah_nilai'</span>), DB::raw(<span class="hljs-string">'AVG(nilai) as rata_nilai'</span>))
    -&gt;groupBy(<span class="hljs-string">'mahasiswa_id'</span>)
    -&gt;havingRaw(<span class="hljs-string">'AVG(nilai) &gt; ? AND COUNT(*) &gt; ?'</span>, [<span class="hljs-number">75</span>, <span class="hljs-number">3</span>])
    -&gt;get();
</div></code></pre>
<h2 id="5-union-queries">5. Union Queries</h2>
<pre class="hljs"><code><div>$mahasiswaAktif = DB::table(<span class="hljs-string">'mahasiswa'</span>)
    -&gt;select(<span class="hljs-string">'id'</span>, <span class="hljs-string">'nama'</span>, <span class="hljs-string">'nim'</span>)
    -&gt;where(<span class="hljs-string">'status'</span>, <span class="hljs-string">'aktif'</span>);

$mahasiswaCuti = DB::table(<span class="hljs-string">'mahasiswa'</span>)
    -&gt;select(<span class="hljs-string">'id'</span>, <span class="hljs-string">'nama'</span>, <span class="hljs-string">'nim'</span>)
    -&gt;where(<span class="hljs-string">'status'</span>, <span class="hljs-string">'cuti'</span>);

$hasil = $mahasiswaAktif-&gt;union($mahasiswaCuti)-&gt;get();
</div></code></pre>
<h2 id="6-pagination-dan-chunk-processing">6. Pagination dan Chunk Processing</h2>
<h3 id="manual-pagination">Manual Pagination</h3>
<pre class="hljs"><code><div>$perPage = <span class="hljs-number">15</span>;
$currentPage = request()-&gt;input(<span class="hljs-string">'page'</span>, <span class="hljs-number">1</span>);
$offset = ($currentPage - <span class="hljs-number">1</span>) * $perPage;

$mahasiswa = DB::table(<span class="hljs-string">'mahasiswa'</span>)
    -&gt;offset($offset)
    -&gt;limit($perPage)
    -&gt;get();

$totalRecords = DB::table(<span class="hljs-string">'mahasiswa'</span>)-&gt;count();
$totalPages = ceil($totalRecords / $perPage);
</div></code></pre>
<h3 id="chunk-processing-untuk-data-besar">Chunk Processing untuk Data Besar</h3>
<pre class="hljs"><code><div>DB::table(<span class="hljs-string">'mahasiswa'</span>)-&gt;orderBy(<span class="hljs-string">'id'</span>)-&gt;chunk(<span class="hljs-number">100</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($mahasiswas)</span> </span>{
    <span class="hljs-keyword">foreach</span> ($mahasiswas <span class="hljs-keyword">as</span> $mahasiswa) {
        <span class="hljs-comment">// Proses data mahasiswa</span>
    }
    
    <span class="hljs-comment">// Return false untuk menghentikan proses</span>
    <span class="hljs-comment">// return false;</span>
});
</div></code></pre>
<h2 id="7-locking-untuk-operasi-transactional">7. Locking untuk Operasi Transactional</h2>
<h3 id="shared-lock-lock-for-read">Shared Lock (Lock for Read)</h3>
<pre class="hljs"><code><div>DB::transaction(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    $mahasiswa = DB::table(<span class="hljs-string">'mahasiswa'</span>)
                   -&gt;where(<span class="hljs-string">'id'</span>, <span class="hljs-number">1</span>)
                   -&gt;sharedLock()
                   -&gt;first();
    
    <span class="hljs-comment">// Operasi lainnya</span>
});
</div></code></pre>
<h3 id="exclusive-lock-lock-for-update">Exclusive Lock (Lock for Update)</h3>
<pre class="hljs"><code><div>DB::transaction(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    $mahasiswa = DB::table(<span class="hljs-string">'mahasiswa'</span>)
                   -&gt;where(<span class="hljs-string">'id'</span>, <span class="hljs-number">1</span>)
                   -&gt;lockForUpdate()
                   -&gt;first();
    
    <span class="hljs-comment">// Update data yang dikunci</span>
    DB::table(<span class="hljs-string">'mahasiswa'</span>)
        -&gt;where(<span class="hljs-string">'id'</span>, <span class="hljs-number">1</span>)
        -&gt;update([<span class="hljs-string">'status'</span> =&gt; <span class="hljs-string">'lulus'</span>]);
});
</div></code></pre>
<h2 id="8-advanced-insert-update-dan-delete">8. Advanced Insert, Update, dan Delete</h2>
<h3 id="insert-dengan-data-yang-kompleks">Insert dengan Data yang Kompleks</h3>
<pre class="hljs"><code><div>DB::table(<span class="hljs-string">'mahasiswa'</span>)-&gt;insert([
    [<span class="hljs-string">'nama'</span> =&gt; <span class="hljs-string">'Ahmad'</span>, <span class="hljs-string">'nim'</span> =&gt; <span class="hljs-string">'10001'</span>, <span class="hljs-string">'jurusan_id'</span> =&gt; <span class="hljs-number">1</span>, <span class="hljs-string">'created_at'</span> =&gt; now()],
    [<span class="hljs-string">'nama'</span> =&gt; <span class="hljs-string">'Budi'</span>, <span class="hljs-string">'nim'</span> =&gt; <span class="hljs-string">'10002'</span>, <span class="hljs-string">'jurusan_id'</span> =&gt; <span class="hljs-number">1</span>, <span class="hljs-string">'created_at'</span> =&gt; now()],
    [<span class="hljs-string">'nama'</span> =&gt; <span class="hljs-string">'Citra'</span>, <span class="hljs-string">'nim'</span> =&gt; <span class="hljs-string">'10003'</span>, <span class="hljs-string">'jurusan_id'</span> =&gt; <span class="hljs-number">2</span>, <span class="hljs-string">'created_at'</span> =&gt; now()],
]);
</div></code></pre>
<h3 id="update-atau-insert-upsert">Update atau Insert (Upsert)</h3>
<pre class="hljs"><code><div>DB::table(<span class="hljs-string">'mahasiswa'</span>)-&gt;updateOrInsert(
    [<span class="hljs-string">'nim'</span> =&gt; <span class="hljs-string">'10001'</span>], <span class="hljs-comment">// Kondisi pencarian</span>
    [<span class="hljs-string">'nama'</span> =&gt; <span class="hljs-string">'Ahmad Revisi'</span>, <span class="hljs-string">'jurusan_id'</span> =&gt; <span class="hljs-number">1</span>, <span class="hljs-string">'updated_at'</span> =&gt; now()] <span class="hljs-comment">// Data yang diupdate/diinsert</span>
);
</div></code></pre>
<h3 id="update-dari-subquery">Update dari Subquery</h3>
<pre class="hljs"><code><div>DB::table(<span class="hljs-string">'mahasiswa'</span>)
    -&gt;where(<span class="hljs-string">'jurusan_id'</span>, <span class="hljs-number">1</span>)
    -&gt;update([
        <span class="hljs-string">'status'</span> =&gt; <span class="hljs-string">'alumni'</span>,
        <span class="hljs-string">'tahun_lulus'</span> =&gt; DB::raw(<span class="hljs-string">'(SELECT YEAR(CURDATE()))'</span>)
    ]);
</div></code></pre>
<h3 id="delete-dengan-join">Delete dengan Join</h3>
<pre class="hljs"><code><div>DB::table(<span class="hljs-string">'mahasiswa'</span>)
    -&gt;join(<span class="hljs-string">'status_registrasi'</span>, <span class="hljs-string">'mahasiswa.id'</span>, <span class="hljs-string">'='</span>, <span class="hljs-string">'status_registrasi.mahasiswa_id'</span>)
    -&gt;where(<span class="hljs-string">'status_registrasi.status'</span>, <span class="hljs-string">'DO'</span>)
    -&gt;where(<span class="hljs-string">'status_registrasi.tahun'</span>, <span class="hljs-string">'&lt;'</span>, <span class="hljs-number">2020</span>)
    -&gt;delete();
</div></code></pre>
<h2 id="9-optimizing-queries">9. Optimizing Queries</h2>
<h3 id="penggunaan-indexes-dalam-query">Penggunaan Indexes dalam Query</h3>
<pre class="hljs"><code><div><span class="hljs-comment">// Pastikan kolom 'nim' telah diindex pada migrasi</span>
<span class="hljs-comment">// $table-&gt;string('nim')-&gt;index();</span>

<span class="hljs-comment">// Query yang memanfaatkan index akan lebih cepat</span>
$mahasiswa = DB::table(<span class="hljs-string">'mahasiswa'</span>)
    -&gt;where(<span class="hljs-string">'nim'</span>, <span class="hljs-string">'10001'</span>)
    -&gt;first();
</div></code></pre>
<h3 id="selecting-only-required-columns">Selecting Only Required Columns</h3>
<pre class="hljs"><code><div><span class="hljs-comment">// Lebih efisien daripada select *</span>
DB::table(<span class="hljs-string">'mahasiswa'</span>)
    -&gt;select(<span class="hljs-string">'id'</span>, <span class="hljs-string">'nama'</span>, <span class="hljs-string">'nim'</span>)
    -&gt;where(<span class="hljs-string">'jurusan_id'</span>, <span class="hljs-number">1</span>)
    -&gt;get();
</div></code></pre>
<h3 id="menggunakan-explain-untuk-analisis-query">Menggunakan Explain untuk Analisis Query</h3>
<pre class="hljs"><code><div>DB::table(<span class="hljs-string">'mahasiswa'</span>)
    -&gt;join(<span class="hljs-string">'jurusan'</span>, <span class="hljs-string">'mahasiswa.jurusan_id'</span>, <span class="hljs-string">'='</span>, <span class="hljs-string">'jurusan.id'</span>)
    -&gt;where(<span class="hljs-string">'jurusan.nama'</span>, <span class="hljs-string">'Informatika'</span>)
    -&gt;select(<span class="hljs-string">'mahasiswa.*'</span>)
    -&gt;explain();
</div></code></pre>
<h2 id="10-kesimpulan-dan-best-practices">10. Kesimpulan dan Best Practices</h2>
<ol>
<li><strong>Gunakan Query Builder dengan Bijak</strong> - Untuk query kompleks, kadang Raw SQL lebih mudah dibaca.</li>
<li><strong>Pertimbangkan Performa</strong> - Selalu pertimbangkan dampak performa pada database saat menulis query.</li>
<li><strong>Hindari N+1 Problem</strong> - Gunakan eager loading atau join untuk menghindari multiple query.</li>
<li><strong>Gunakan Caching untuk Query Berat</strong> - Cache hasil query yang komputasinya berat dan jarang berubah.</li>
<li><strong>Validasi Input</strong> - Selalu validasi input untuk menghindari SQL injection.</li>
</ol>
<p>Query Builder Laravel adalah alat yang sangat kuat untuk mengelola data dalam aplikasi Anda. Dengan memahami teknik lanjutan, Anda dapat mengoptimalkan operasi database dan membuat fitur yang lebih kompleks dengan kode yang lebih bersih dan terstruktur.</p>

</body>
</html>
